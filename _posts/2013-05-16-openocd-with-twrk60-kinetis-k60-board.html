---
layout: post
title: "OpenOCD with TWRK60 - Kinetis K60 board (tutorial for Windows)"
date: 2013-05-16
comments: true
categories:
 - embedded
 - tutorial
---

<div class='post'>
This post will be about openOCD and OSBDM on TWRK60. I'll cover here only in windows system, linux might come later.<br /><br />To start, download precompiled binaries (everything should be enabled, check a text file inside. What I am interested at the moment are two flags there --enable-osbdm). Or if you prefer to compile it with own flags, please visit official openOCD website.<br /><a href="http://www.freddiechopin.info/en/download/category/4-openocd">Download windows precompiled openOCD binaries [freddiechopin.info/en]</a><br /><br />Read libusb-1.0 drivers text file, there's link to ZADIG. libusb must be installed if you want to use J-Link or OSBDM. Having said that, I was not able to make it work with libusb filtered version. I received error during initialization: Can't open OSBDM. Therefore I simply replaced libusb (default) driver by WinUSB. This is the problem I have to solve. I simply don't want to replace driver between using CodeWarrior or OpenOCD.<br /><a href="http://sourceforge.net/projects/libwdi/files/zadig/">Zadig [sourceforge.net/projects/libwdi]</a><br /><br /><br />Create own .cfg file (in my case openocd.cfg) which contains the following text:<br /><pre class="brush: python">source [find ../scripts/interface/osbdm.cfg]<br />source [find ../scripts/board/twr-k60n512.cfg]<br />$_TARGETNAME configure -event gdb-attach {<br />   echo "Halting target"<br />   halt<br />}<br /></pre><br />Open the command line and type:<br /><pre class="brush: python">openocd-0.7.0.exe -f openocd.cfg<br /></pre><br />The output from the console:<br /><span style="font-size: x-small;">Open On-Chip Debugger 0.7.0 (2013-05-05-10:41)</span><br /><span style="font-size: x-small;">Licensed under GNU GPL v2</span><br /><span style="font-size: x-small;">For bug reports, read</span><br /><span style="font-size: x-small;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http://openocd.sourceforge.net/doc/doxygen/bugs.html</span><br /><span style="font-size: x-small;">Info : only one transport option; autoselect 'jtag'</span><br /><span style="font-size: x-small;">srst_only separate srst_gates_jtag srst_open_drain connect_deassert_srst</span><br /><span style="font-size: x-small;">cortex_m3 reset_config sysresetreq</span><br /><span style="font-size: x-small;">Info : add flash_bank kinetis pflash.0</span><br /><span style="font-size: x-small;">Info : add flash_bank kinetis pflash.1</span><br /><span style="font-size: x-small;">Info : OSBDM has opened</span><br /><span style="font-size: x-small;">Info : This adapter doesn't support configurable speed</span><br /><span style="font-size: x-small;">Info : JTAG tap: k60.cpu tap/device found: 0x4ba00477 (mfg: 0x23b, part: 0xba00,</span><br /><span style="font-size: x-small;">&nbsp;ver: 0x4)</span><br /><span style="font-size: x-small;">START...</span><br /><span style="font-size: x-small;">Info : k60.cpu: hardware has 6 breakpoints, 4 watchpoints</span><br /><span style="font-size: x-small;">END...</span><br /><br />Keep the command line open which keeps the connection alive, open terminal (like Putty), create a new instance (telnet) with an address: localhost on port&nbsp; 4444. This should be the output on the terminal: <br /><span style="font-size: x-small;">Open On-Chip Debugger</span><br /><span style="font-size: x-small;">&gt;&nbsp;</span><br /><br />To flash our own image, halt the CPU. <br /><span style="font-size: x-small;">&gt;reset halt</span><br /><span style="font-size: x-small;">JTAG tap: k60.cpu tap/device found: 0x4ba00477 (mfg: 0x23b, part: 0xba00, ver: 0x4)</span><br /><span style="font-size: x-small;">target state: halted</span><br /><span style="font-size: x-small;">target halted due to debug-request, current mode: Thread</span><br /><span style="font-size: x-small;">xPSR: 0x01000000 pc: 0x00009640 msp: 0x2000fbfc</span><br /><br />Ready to flash the S19 image - LED demo (as an example).<br /><span style="font-size: x-small;">&gt; flash write_image erase c:/TWRK60_DEMO.afx.S19 </span><br /><span style="font-size: x-small;">auto erase enabled</span><br /><span style="font-size: x-small;">Probing flash info for bank 0</span><br /><span style="font-size: x-small;">Probing flash info for bank 1</span><br /><span style="font-size: x-small;">no flash bank found for address 1fff0000</span><br /><span style="font-size: x-small;">wrote 0 bytes from file c:/TWRK60_DEMO.afx.S19 in 0.064003s (0.000 KiB/s)</span><br /><br />I am currently having problems to reset the CPU. What is not working currently, it's run command. But if I invoke reset init and resume, it works.<br /><br />There are many commands which are described in OpenOCD Userâ€™s Guide. I'll continue with J-Link and GDB.<br /><br />Update June 8th:<br />I posted how to communicate with the tower board and jlink in the eclipse and I published trivial gpio gcc example for TWRK60N512. See my other posts.<br /><br />References: <br />Official openOCD site <a href="http://openocd.sourceforge.net/">http://openocd.sourceforge.net/</a></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>JF</div>
<div class='content'>
I did get OpenOCD working with the OSBDM/OSJTAG on the tower board, and using Zadig to install the WinUSB driver was necessary to get it working.<br /><br />Thanks for putting this info on the internets!  </div>
</div>
<div class='comment'>
<div class='author'>0xc0170</div>
<div class='content'>
Hello JF,<br /><br />As I remember, I used Zadig (the link right below the text you quoted). Connect the board, find it there in combo form and replace default libusb by WinUSB. You can always revert it back. Let me know if that helps.<br /><br />Regards,<br />0xc0170</div>
</div>
<div class='comment'>
<div class='author'>JF</div>
<div class='content'>
Can you explain how you did this?<br />&gt;&gt; I simply replaced libusb (default) driver by WinUSB<br /><br />I&#39;m having the same trouble with opening the OSBDM interface in Win7.</div>
</div>
</div>
