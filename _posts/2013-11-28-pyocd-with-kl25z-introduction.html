---
layout: post
title: "pyOCD with KL25Z (introduction)"
date: 2013-11-28
comments: true
categories:
 - pyOCD
 - tutorial
---

<div class='post'>
This is an introduction to pyOCD, my very first steps getting familiar with pyOCD. Two mbed users reported locking of their KL25Z chips with pyOCD. I hope we find out why!<br /><br />The pyOCD used to be part of mbed github repository, but not anymore. It was separated, can be found here <a href="https://github.com/mbedmicro/pyOCD">pyOCD repo [github.com/mbedmicro/pyOCD]</a>. It has awesome readme file there, which serves as documentation.<br /><br />the official mbed page for pyOCD <a href="https://mbed.org/blog/entry/Debugging-from-GDB-using-pyOCD/">Debuging from GDB using pyOCD [mbed.org/blog]</a>.<br /><br />I started with pywinusb (using windows on my laptop), installed via easy_install.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-t_knAIDju2c/Upd2WCilkeI/AAAAAAAAD00/EGa4FjXNn4E/s1600/install+pywinusb.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="130" src="http://1.bp.blogspot.com/-t_knAIDju2c/Upd2WCilkeI/AAAAAAAAD00/EGa4FjXNn4E/s320/install+pywinusb.PNG" width="320" /></a></div><br />The second step <span style="font-family: inherit;">was </span>to build pyOCD, run from the pyOCD root directory<code> python setup.py install<span style="font-size: small;">.</span><span style="font-family: inherit;"><br /></span></code><br /><br /><span style="font-family: inherit;">Connect KL25Z to your PC, be certain it has mbed interface! Time to start g</span>db session, either gdb from toolchain or from pyOCD. I chose to run gdb_test.py which is in pyOCD/test folder.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-uvrBLzbf2hA/Upd257xqdaI/AAAAAAAAD08/StvQXb8LpHY/s1600/kl25z+connected+-+gdb+server.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="88" src="http://4.bp.blogspot.com/-uvrBLzbf2hA/Upd257xqdaI/AAAAAAAAD08/StvQXb8LpHY/s320/kl25z+connected+-+gdb+server.PNG" width="320" /></a></div><br />KL25Z detected, presume to flashing part. To be save, I opened basic_test.py located in test directory and commented out line 156<span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;"> <span style="font-size: x-small;">flash.flashBinary(binary_file)</span></span></span>. <span style="font-size: small;"><span style="font-family: inherit;">This prevents from flashing (locking alert which I explain later).</span></span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-y3c90UyTklw/Upd41pYd31I/AAAAAAAAD1I/XzDwJSCHr6M/s1600/pyOCD+-+test.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://1.bp.blogspot.com/-y3c90UyTklw/Upd41pYd31I/AAAAAAAAD1I/XzDwJSCHr6M/s320/pyOCD+-+test.PNG" width="255" /></a></div><br />Everything went ok according to the console, flashing was skipped though. Now return the line 156 to test flashing part. Have ready compiled GCC program (I use bin file from the example I created for mbed GCC KL25Z demo).<br /><br />If you run it without arguments, the default path is <i>/binaries/l1_target.bin</i>, the name of bin file for KL25Z&nbsp;is <span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">l1_kl25z.bin</span></span> .<span style="font-size: small;"><span style="font-family: inherit;"> Flashing was successful but program was not running correctly and chip got to secured state. I restarted gdb test script, received an error. I opened uVision, it displays a warning that chip is locked, but not permanently, fortunately! I have to get my prototype board, to continue with testing.</span></span><br /><br /><span style="font-size: small;"><span style="font-family: inherit;">I'll share more once I explore what's going on and why chip got locked once.</span></span><br /><br /><b><span style="font-size: small;"><span style="font-family: inherit;">Update 1st of December:</span></span></b><br /><span style="font-size: small;"><span style="font-family: inherit;">I have been debugging it for a while, I added some extra code which completely messed connection to the chip, gdb returned error. Once I found out what I did wrong, everything seems to be functional.</span></span><br /><span style="font-size: small;"><span style="font-family: inherit;">Even flashing different binaries does not lock chip, still using pyOCD scripts, not directly its gdb implementation.</span></span><br /><span style="font-size: small;"><span style="font-family: inherit;"><br /></span></span><br /><br /></div>
