---
layout: post
title: "CoIDE with KL25Z and mbed (C++) (tutorial)"
date: 2014-01-11
comments: true
categories:
 - tutorial
 - mbed
---

<div class='post'>
I decided to start contributed to open source one year ago, as my start project I selected CoX library. I was pleased with CooCox CoIDE back in those days, it's light, easy to set-up, fast and was reliable. However, I abandoned CoX library since than as well as their IDE named CoIDE. This tutorial brings back CoIDE to my life as GCC is supported to all available Freescale targets.<br /><br />I am running this tutorial on KL25Z, but as I checked, also NXP chips are supported there so this should be applied to more mbed targets than just KL25Z.<br /><br />I ported CMSIS-DAP to many new freescale chips, now also bootloader is available. I was looking for open source IDE with working debugger. Finally, found something which is fast, reliable, and works with just few steps.<br /><br />The very first thing is to install CoIDE.&nbsp; Visit link <a href="http://www.coocox.org/CooCox_CoIDE.htm">CooCox IDE [www.coocox.org]</a> . The installation is straightforward. Once installed, open your CoIDE and select toolchain path<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-6NTRjgNqsys/UtGrgG3uENI/AAAAAAAAENc/yWH4lSUwOgk/s1600/CoIDE-path.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-6NTRjgNqsys/UtGrgG3uENI/AAAAAAAAENc/yWH4lSUwOgk/s1600/CoIDE-path.jpg" height="213" width="400" /></a></div><br /><br />I added there the following path :<br />C:\Program Files\GNU Tools ARM Embedded\4.7 2013q3\bin<br /><br /><b>If you want to test mbed with KL25Z in CoIDE</b>, download the project here <a href="http://mbed.org/media/uploads/Kojto/mbed_10_coide_kl25z.zip">Hello world project KL25Z CoIDE [mbed.org/media/uploads/Kojto]</a>. I'll explain below how to create your own project, so you can change anything you like like adding your own sources, libraries.<br /><br />In the same tab as Select Toolchain Path, there's New Project (the top selection). Create a new project, select a name and click next. I use KL25Z_mbed as name of the project (which will be used in some steps, so might follow the same).<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-PxjjgYaw-bQ/UtGsh1_qn_I/AAAAAAAAENk/IbUDhPS3pAw/s1600/CoIDE-1.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-PxjjgYaw-bQ/UtGsh1_qn_I/AAAAAAAAENk/IbUDhPS3pAw/s1600/CoIDE-1.JPG" height="263" width="320" /></a></div>The next step is to select a chip or a board, just use Chip<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-IVAr1MF3QKk/UtGs0pGcryI/AAAAAAAAENs/-7LvZnE2GiU/s1600/CoIDE-2.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-IVAr1MF3QKk/UtGs0pGcryI/AAAAAAAAENs/-7LvZnE2GiU/s1600/CoIDE-2.JPG" height="264" width="320" /></a></div>The chip which is assembled on the freedom KL25Z board, is MKL25Z128VLK4. Then click Finish. The project is created and should be visible in the right bottom corner.<br /><br />This creates an empty project with one code file (main.c). Please remove that file. Export a basic hello world example from the mbed site (GCC export option), as reference this one <a href="http://mbed.org/users/simon/code/HelloWorld/">Hello world example [mbed.org/users/simon/code]</a>. Add it to your online compiler and export it to GCC.<br /><br />Unzip the exported Hello world anywhere. The example has only main.cpp file and the mbed folder which contains mbed library with header files + some object files. We need to copy those files to our new created project's folder. There is already .coproj file which gets created later, so don't get surprised by the below picture.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-eDLp5rR1K3s/UtGwWpdwkSI/AAAAAAAAEN4/ANpOv1h9gDE/s1600/CoIDE-4.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-eDLp5rR1K3s/UtGwWpdwkSI/AAAAAAAAEN4/ANpOv1h9gDE/s1600/CoIDE-4.JPG" height="94" width="320" /></a></div><br />&nbsp;After copying them, we go back to CoIDE where we need to set-up our new project. Click on the project with the right-button on your mouse, and select Configuration.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-I0vMCnJ3MLk/UtGxY0gXgnI/AAAAAAAAEOA/fc--BySAp7I/s1600/CoIDE-5.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-I0vMCnJ3MLk/UtGxY0gXgnI/AAAAAAAAEOA/fc--BySAp7I/s1600/CoIDE-5.jpg" height="320" width="208" /></a></div>This is the crucial step, to set up correctly gcc project. There are few tabs : Device, Compile, Link and more.<br /><br />We can skip device, as we already set device (chip). Go to the Compile tab:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-iam7xhXsVd0/UtGyBuAJ3LI/AAAAAAAAEOI/9JbTij8IFTE/s1600/CoIDE-6.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-iam7xhXsVd0/UtGyBuAJ3LI/AAAAAAAAEOI/9JbTij8IFTE/s1600/CoIDE-6.JPG" height="264" width="640" /></a></div><br />Add include paths (mbed folder, target_kl25z folder inside and the toolchain_gcc_arm which is inside target_kl25z folder). Add to Misc. Controls:<br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">-fno-common; -fmessage-length=0; -Wall; -fno-exceptions; -ffunction-sections; -fdata-sections; -DTARGET_KL25Z; -DTARGET_M0P; -DTARGET_Freescale; -DTOOLCHAIN_GCC_ARM; -DTOOLCHAIN_GCC; -D__CORTEX_M0PLUS; -DARM_MATH_CM0PLUS;&nbsp; -std=gnu++98</span><br /><br />We could add those defines up there to Defined Symbols, does not matter though. This should be for compile tab, move to the Link tab.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-vbFWuY7hLfQ/UtGywGqnQoI/AAAAAAAAEOU/Zrw3GHEh_h8/s1600/CoIDE-7.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-vbFWuY7hLfQ/UtGywGqnQoI/AAAAAAAAEOU/Zrw3GHEh_h8/s1600/CoIDE-7.JPG" height="326" width="640" /></a></div><br />The important detail here is to uncheck <i>Use Memory Layout from Memory Window</i> and add linker script path (scatter file).<br /><br />Add this to Misc. Controls:<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">--specs=nano.specs; </span>${project.path}/mbed/target_kl25z/toolchain_gcc_arm/cmsis_nvic.o; ${project.path}/mbed/target_kl25z/toolchain_gcc_arm/retarget.o; ${project.path}/mbed/target_kl25z/toolchain_gcc_arm/startup_MKL25Z4.o; ${project.path}/mbed/target_kl25z/toolchain_gcc_arm/system_MKL25Z4.o;</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: Arial,Helvetica,sans-serif;">Add to Linked Libraries (just type the names<span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;"><span style="font-family: Arial,Helvetica,sans-serif;"> there</span></span>)</span>:</span></span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: Arial,Helvetica,sans-serif;">mbed, </span></span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: Arial,Helvetica,sans-serif;"><span style="font-size: small;"><span>stdc++ , </span><span>supc++ ,</span><span> m , </span><span>gcc , </span><span>c</span><span> , nosys</span></span> </span></span><br /><br />The last thing to check is Debug tab, where select CMSIS-DAP, SWD and 1MHZ (this should be set as default for that chip).<br /><br />Now press F7 (BUILD) which builds the project. It should display BUILD SUCCESSFUL if everything is correct along with size of the each areas and the command invoked.<br /><br />Connect your board which mbed interface (CMSIS-DAP) and click on Debug icon (or press CTRL+F5). Debugging starts, it puts the breakpoint inside the main function, as it's shown in the picture below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Ib__7qGU0fU/UtG0yvrsdvI/AAAAAAAAEOg/LqUzDFHY8rw/s1600/CoIDE-8.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-Ib__7qGU0fU/UtG0yvrsdvI/AAAAAAAAEOg/LqUzDFHY8rw/s1600/CoIDE-8.JPG" height="400" width="337" /></a></div><br />Happy debugging ! I am surprised with a speed, compared to pyOCD I tried with eclipse, this is really quick.<br /><br />I will find out when other mbed chips are going to be supported.<br /><br />Update1: I am currently working on an exporter to CoIDE for KL25Z, and probably later also other targets will follow.<br /><br /><br /></div>
